<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="keywords"
      content="Data Science, Analytics, Data, sass, software company"
    />
    <meta
      name="description"
      content="NLP is designed especially for the agency, multipurpose and business and those who offer business-related services."
    />
    <meta property="og:site_name" content="Sinco" />
    <meta property="og:url" content="https://heloshape.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="NLP" />
    <meta name="og:image" content="images/assets/ogg.png" />
    <!-- For IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- For Resposive Device -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- For Window Tab Color -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#913BFF" />
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#913BFF" />
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#913BFF" />
    <title>EXTRACT</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      sizes="56x56"
      href="assets/images/fav-icon/icon.png"
    />
    <!-- Main style sheet -->
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/css/style.css"
      media="all"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/predictions.css"
      media="all"
    />
    <!-- responsive style sheet -->
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/css/responsive.css"
      media="all"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      .switcher {
        display: none;
      }
    </style>
    <style>
      .dt-buttons {
        display: none;
      }
    </style>
    <style>
      .filter-buttons .btn {
        margin-inline-end: 5px;
      }
    </style>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css"
    />
  </head>

  <body>
    <div class="container mt-2">
      <a class="nav-link p-0 mb-3 fw-bold" href="/" role="button">
        <i class="fas fa-arrow-left"></i> Kembali ke Halaman Utama
      </a>

      <section class="rekap-hasil-ekstraksi">
        <div class="card">
          <div class="p-5">
            <h4 class="mt-3 mb-4 fw-bold">Rekap Hasil Ekstraksi</h4>
            <div class="container">
              <div class="row gap-4">
                <div class="col border p-4">
                  <h6 class="fw-semibold">Total Kalimat Ulasan</h6>
                  <span id="totalReviews"></span>
                </div>
                <div class="col border p-4">
                  <h6 class="fw-semibold">Total Ulasan Berlabel Tunggal</h6>
                  <span id="singleLabeledReviews"></span>
                </div>
                <div class="col border p-4">
                  <h6 class="fw-semibold">Total Ulasan Berlabel Majemuk</h6>
                  <span id="multiLabeledReviews"></span>
                </div>
                <div class="col border p-4">
                  <h6 class="fw-semibold">Total Ulasan Tidak Berlabel</h6>
                  <span id="unlabeledReviews"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="hasil-ekstraksi-ulasan">
        <div class="card p-5 mt-3 container">
          <div class="p-4 mb-3 bg-purple">
            <h3 class="mt-5 fw-bolder text-white">
              Hasil Ekstraksi Ulasan
              <span class="h5 fw-semibold text-white"
                >Metode <span id="algorithm"></span
              ></span>
            </h3>
          </div>
          <div class="alert alert-info" role="alert">
            <p class="m-0">
              <span class="fw-bold"
                ><i class="fa-solid fa-circle-exclamation"></i> Perhatian:</span
              >
              Hasil ekstraksi yang diberikan oleh aplikasi ini bersifat
              prediktif dan tidak menjamin keakuratan 100% . Ada kemungkinan
              hasil ekstraksi tidak benar atau valid secara mutlak. Pastikan
              untuk melakukan verifikasi manual dan validasi ulang sebelum
              mengambil keputusan berdasarkan hasil ekstraksi ini!
            </p>
          </div>

          <div class="mb-3">
            <button class="btn btn-primary export-button" id="copyButton">
              Copy
            </button>
            <button class="btn btn-primary export-button" id="csvButton">
              CSV
            </button>
            <button class="btn btn-primary export-button" id="excelButton">
              Excel
            </button>
            <button class="btn btn-primary export-button" id="printButton">
              Print
            </button>
          </div>

          <!-- Label Filter Buttons -->
          <div class="container p-0">
            <h5>Filters:</h5>
            <div class="filter-buttons mb-3" id="labelFilterButtons"></div>
            <button class="btn btn-secondary mb-3" id="clearFiltersButton">
              Clear Filters
            </button>
          </div>

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#table"
                >TABLE</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#pieChartContainer"
                >PIE CHART</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#barChartContainer"
                >BAR CHART</a
              >
            </li>
          </ul>

          <div class="tab-content">
            <div id="table" class="container tab-pane active">
              <br />
              <table
                id="predictionsTable"
                class="display"
                style="width: 100%"
              ></table>
            </div>
            <div id="pieChartContainer" class="container tab-pane fade">
              <br />
              <canvas id="pieChart" style="max-height: 500px"></canvas>
            </div>
            <div id="barChartContainer" class="container tab-pane fade">
              <br />
              <canvas id="barChart" style="max-height: 500px"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Optional JavaScript _____________________________  -->

      <!-- jQuery first, then Bootstrap JS -->
      <!-- jQuery -->
      <script src="/assets/vendor/jquery.min.js"></script>
      <!-- Bootstrap JS -->
      <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
      <!-- AOS js -->

      <!-- DataTables -->
      <script
        type="text/javascript"
        charset="utf8"
        src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"
      ></script>
      <!-- DataTables Buttons -->
      <script
        type="text/javascript"
        src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"
      ></script>
      <script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"
      ></script>
      <script
        type="text/javascript"
        src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"
      ></script>
      <script
        type="text/javascript"
        src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"
      ></script>

      <script type="text/javascript">
        // Load data and render the table and charts
        $(document).ready(function () {
          $.getJSON(
            "{{ url_for('prediction.api_predictions') }}",
            function (data) {
              let columns = [
                { data: "review", title: "Review" },
                // { data: "Predictions", title: "Predictions" },
              ];

              // console.log(Object.keys(data[0]));

              // Dynamically add columns for one-hot encoded labels
              if (data.length > 0) {
                columns.push(
                  { data: "Dep", title: "Dependability" },
                  { data: "Per", title: "Performance" },
                  { data: "Sup", title: "Supportablity" },
                  { data: "Usa", title: "Usability" },
                  { data: "Mis", title: "Missing" }
                );

                // let keys = Object.keys(data[0]);
                console.log($(columns));
                columns.forEach(function (column) {
                  if (column.data !== "review") {
                    temp = columns.title;
                    // columns.push({ data: key, title: temp });

                    // Add buttons to filter buttons div
                    $("#labelFilterButtons").append(
                      '<button class="btn btn-outline-primary filter-btn" id="' +
                        column.data +
                        "-filter-btn" +
                        '" data-label="' +
                        column.data +
                        '">' +
                        temp +
                        "</button>"
                    );
                  }
                });
              }

              var table = $("#predictionsTable").DataTable({
                data: data,
                columns: columns,
                scrollX: true,
                columnDefs: [
                  {
                    targets: [0],
                    className: "dt-justify review-column",
                  },
                  {
                    targets: [1],
                    visible: false,  // Menyembunyikan kolom dengan target [1]
                  },
                  {
                    targets: "_all",
                    className: "dt-center",
                    createdCell: function (td, cellData, rowData, row, col) {
                      if (cellData === "✓") {
                        $(td).addClass("checkmark");
                      }
                    },
                  },
                ],
                dom: "Bfrtip",
                buttons: [
                  {
                    extend: "copyHtml5",
                    text: "Copy",
                    className: "btn btn-primary export-button",
                  },
                  {
                    extend: "csvHtml5",
                    text: "CSV",
                    className: "btn btn-primary export-button",
                  },
                  {
                    extend: "excelHtml5",
                    text: "Excel",
                    className: "btn btn-primary export-button",
                  },
                  {
                    extend: "pdfHtml5",
                    text: "PDF",
                    className: "btn btn-primary export-button",
                  },
                  {
                    extend: "print",
                    text: "Print",
                    className: "btn btn-primary export-button",
                  },
                ],
              });

              // Custom buttons trigger
              $("#copyButton").click(function () {
                table.button(".buttons-copy").trigger();
              });
              $("#csvButton").click(function () {
                table.button(".buttons-csv").trigger();
              });
              $("#excelButton").click(function () {
                table.button(".buttons-excel").trigger();
              });
              $("#pdfButton").click(function () {
                table.button(".buttons-pdf").trigger();
              });
              $("#printButton").click(function () {
                table.button(".buttons-print").trigger();
              });

              let activeFilters = [];

              // Label filter buttons click event
              $(document).on("click", ".filter-btn", function () {
                console.log($(this));
                console.log($(this));
                var selectedLabel = $(this).data("label");

                let index = activeFilters.indexOf(selectedLabel);

                if (index !== -1) {
                  $(this).removeClass("active");
                  activeFilters.splice(index, 1);
                } else {
                  $(this).addClass("active");
                  activeFilters.push(selectedLabel);
                }

                // table
                //   .column(":contains(" + selectedLabel + ")")
                //   .search("✓")
                //   .draw();
                
                table.columns().search("").draw(); // Reset all filters

                // Apply search for each active filter
                activeFilters.forEach(function (filter) {
                  table.column(":contains(" + filter + ")").search("✓");
                });

                // Redraw the table to reflect filter changes
                table.draw();
              });

              // Clear filters button click event
              $("#clearFiltersButton").click(function () {
                // let searchValue = $('#predictionsTable_filter input[type="search"]').val();
                activeFilters = [];
                $(".filter-btn").removeClass("active");
                table.columns().search("").draw(); // Reset all filters
              });

              // Load statistics
              let algorithm = "{{ algorithm }}";
              let totalReviews = parseInt("{{ total_reviews }}");
              let totalLabels = parseInt("{{ total_labels }}");
              let singleLabeledReviews = parseInt(
                "{{ single_labeled_reviews }}"
              );
              let multiLabeledReviews = parseInt("{{ multi_labeled_reviews }}");
              let unlabeledReviews =
                totalReviews - (singleLabeledReviews + multiLabeledReviews);

              if (algorithm == "ensemble") {
                algorithm = "Ensemble";
              } else if (algorithm === "bert") {
                algorithm = "BERT";
              }

              $("#algorithm").text(algorithm);
              $("#totalReviews").text(totalReviews);
              $("#totalLabels").text(totalLabels);
              $("#singleLabeledReviews").text(singleLabeledReviews);
              $("#multiLabeledReviews").text(multiLabeledReviews);
              $("#unlabeledReviews").text(unlabeledReviews);

              // Render charts using Chart.js
              var ctxPie = document.getElementById("pieChart").getContext("2d");
              var pieChart = new Chart(ctxPie, {
                type: "pie",
                data: {
                  labels: [
                    "Single Labeled Reviews",
                    "Multi Labeled Reviews",
                    "Unlabeled Reviews",
                  ],
                  datasets: [
                    {
                      data: [
                        singleLabeledReviews,
                        multiLabeledReviews,
                        unlabeledReviews,
                      ],
                      backgroundColor: ["#36a2eb", "#ff6384", "#666"],
                    },
                  ],
                },
                options: {
                  responsive: true,
                },
              });

              var ctxBar = document.getElementById("barChart").getContext("2d");
              var barChart = new Chart(ctxBar, {
                type: "bar",
                data: {
                  labels: columns.slice(2).map((col) => col.title),
                  datasets: [
                    {
                      label: "Total Labels",
                      data: columns
                        .slice(2)
                        .map((col) =>
                          data.reduce(
                            (sum, row) => sum + (row[col.data] === "✓" ? 1 : 0),
                            0
                          )
                        ),
                      backgroundColor: "#4bc0c0",
                    },
                  ],
                },
                options: {
                  responsive: true,
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            }
          );
        });
      </script>
    </div>

    <footer class="bg-purple">
      <div class="container col-xxl-9 px-4 py-4">
        <div class="row">
          <p class="text-white m-0">
            Copyright 2024 <span class="fw-bold">EXTRACT</span>. All rights
            reserved.
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
